# Smash Ticket Manager v9

『大乱闘スマッシュブラザーズ SPECIAL』対戦会などのイベントで利用できる、Webベースの整理券・呼び出し管理システムです。
React (Vite) によるモダンなUIと、PHPによるシンプルなファイルベースのデータ保存を組み合わせており、データベース不要でレンタルサーバー（さくらインターネット等）に簡単に設置できます。

## ✨ 主な機能

* **整理券管理**: ワンクリックで整理券を発行。DLC希望や卓指名にも対応。
* **呼び出し自動化**: 「次を呼ぶ」ボタンで、条件（空き卓、DLC有無、指名）に合う人を自動判定して呼び出し。
* **音声アナウンス**: ブラウザの音声合成機能で「次は番号、〇〇番です」と読み上げ。
* **卓管理**: 卓ごとの空き状況、DLC対応/非対応の切り替え、対戦終了処理。
* **リアルタイム同期**: ポーリング処理により、複数のデバイス（受付PC、投影用モニタ、スマホ等）で状態を同期。
* **スマホ対応**: レスポンシブデザインにより、スマホでは操作パネルが最適化されます。
* **Undo機能**: 操作を間違えた場合に1つ前の状態に戻せます。

## 📂 ディレクトリ構成

```text
smash-manager/
├── public/
│   ├── .htaccess            # サーバー設定 (ルーティング用)
│   ├── api.php              # バックエンド処理 (データの保存・読み込み)
│   ├── data.json            # データ保存ファイル (自動生成されます)
│   └── icon.png             # ファビコン用画像 (任意)
├── src/
│   ├── components/          # UIコンポーネント
│   │   ├── HistoryList.tsx  # 操作履歴リスト
│   │   ├── LoginModal.tsx   # ログインリスト
│   │   ├── TableManager.tsx # 卓一覧・操作パネル
│   │   └── TicketCard.tsx   # 整理券カード
│   ├── hooks/               # カスタムフック
│   │   ├── useAudio.ts      # 音声・ビープ音処理
│   │   └── useSmashState.ts # アプリ全体のメインロジック
│   ├── pages/               # ページコンポーネント
│   │   ├── Admin.tsx        # 管理画面 (/)
│   │   └── Viewer.tsx       # 閲覧用画面 (/viewer)
│   ├── types/               # TypeScript型定義
│   │   └── index.ts
│   ├── utils/               # 純粋な計算ロジック
│   │   └── smashLogic.ts    # 次に呼ぶ人の判定アルゴリズム等
│   ├── App.tsx              # ルーティング定義
│   ├── main.tsx             # エントリーポイント
│   └── index.css            # Tailwind CSS設定
├── index.html               # エントリーHTML
├── tailwind.config.js       # Tailwind設定
├── tsconfig.json            # TypeScript設定
├── vite.config.ts           # Viteビルド設定 (.htaccessに合わせてbaseを設定)
└── package.json             # 依存パッケージ管理
```
🚀 開発環境のセットアップ
Node.js がインストールされている必要があります。また、ローカルでデータ保存をテストするには PHP が必要です。

1. インストール
```bash
npm install
```
2. ローカルサーバーの起動
ターミナルを2つ開いて実行してください。

ターミナル 1 (バックエンド: PHP) データの保存先となるAPIサーバーを立ち上げます。

```bash
cd public
php -S localhost:8000
```
ターミナル 2 (フロントエンド: Vite) Reactアプリを立ち上げます。

```bash
npm run dev
```
ブラウザで http://localhost:5173 にアクセスすると動作確認できます。

🌐 デプロイ手順 (さくらインターネット等)
このシステムは静的ファイルとしてビルドし、PHPが動くWebサーバーに配置するだけで動作します。

1. ビルド
```bash
npm run build
```
プロジェクト内に dist フォルダが生成されます。

2. アップロード
FTPソフト等でサーバーに接続し、以下のファイルを公開ディレクトリ（例: www/smash）にアップロードします。

dist フォルダの中身すべて (index.html, assets/ 等)

public/api.php (※ビルド時に dist に含まれていない場合は手動でコピーしてください)

3. 権限設定 (重要)
サーバー上で data.json を生成・更新できるように、アップロードしたフォルダ自体のパーミッションを 755 または 777 に設定してください。

うまくいかない場合は、空の data.json を手動でアップロードし、そのファイルのパーミッションを 666 に設定してください。

📖 使い方マニュアル
基本的な流れ
1. 卓の設定: 右側（スマホでは下）の「卓管理」で、卓数を入力します。各卓の「DLC」チェックボックスで、DLC対応状況を設定します。

2. 整理券の発行: 参加者が来たら「整理券追加」ボタンを押します。

    - DLC希望の場合は「DLC」にチェック。

    - 特定の卓希望の場合はプルダウンで選択。

3. 呼び出し:

    - 自動: 「次を呼ぶ」ボタンを押すと、空いている卓に合わせて最適な人が呼び出されます。

    - 手動: 整理券カードの「呼び出す」ボタンで特定の人を呼ぶことも可能です。

4. 着席:

    - 呼び出し中の整理券の「着席」ボタンを押すと、空き卓に割り当てられます。

    - 卓側の「着席」ボタンを押して、呼び出し中の人を座らせることも可能です。

5. 対戦終了:

    - 卓の「終了」ボタンを押すと、卓が空き状態になり、整理券は「完了済み」に移動します。

ショートカットキー (PCのみ)
- n: 次を呼ぶ

- u: Undo（操作を取り消す）

- Space: 現在呼び出し中の番号を再読み上げ

- 1 ～ 9: 対応する番号の卓を「終了」または「着席」させる

注意点
- スルー機能: 呼び出しても来ない場合は「スルー」を押してください。一時的にスキップ扱いとなり、次の人を呼べるようになります。戻ってきたら「戻す」ボタンで復帰できます。

完- 全リセット: イベント終了時などは「完全リセット」でデータを消去できます。通常の「リセット」は履歴が残るためUndo可能です。

🛠️ 技術スタック
Frontend: React, TypeScript, Vite

Styling: Tailwind CSS

Backend: PHP (Simple JSON File Storage)

Infrastructure: Static Hosting + PHP Support (e.g., Sakura Internet Standard)